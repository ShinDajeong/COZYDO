<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cozydo.mapper.PlaceMapper">

	<select id="findByLatAndLon" parameterType="map" resultType="com.cozydo.model.place.PlaceDto">
		SELECT p.place_idx as placeIdx, p.place_name as placeName, p.sub_category as subCategory, p.gu, p.dong, p.address_name as addressName,
				p.road_address_name as roadAddressName, p.place_lon as placeLon, p.place_lat as placeLat,
				6371*acos(cos(radians(#{lat}))*cos(radians(p.place_lat))*cos(radians(p.place_lon)-radians(#{lon})) +sin(radians(#{lat}))*sin(radians(p.place_lat))) as distance
		FROM place p
		LEFT JOIN category c on p.sub_category = c.sub_category 
		WHERE place_name LIKE CONCAT('%',#{keyword},'%') OR c.sub_category_name LIKE CONCAT('%',#{keyword},'%')
		HAVING distance &lt;= 0.5
		ORDER BY distance
		LIMIT 300
		
	</select>
	
	<select id="findByIdx" parameterType="map" resultType="com.cozydo.model.place.PlaceDto">
		SELECT place_idx as placeIdx, place_name as placeName, sub_category as subCategory, gu, p.dong, address_name as addressName,
				road_address_name as roadAddressName, place_lon as placeLon, place_lat as placeLat
		FROM place p
		WHERE place_idx = #{placeIdx}
		
	</select>
</mapper>