<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cozydo.mapper.PlaceMapper">

	<select id="findByLatAndLon" parameterType="map" resultType="com.cozydo.model.place.PlaceDto">
		SELECT p.place_idx as placeIdx, p.place_name as placeName, p.sub_category as subCategory, p.gu, p.dong, p.address_name as addressName,
				p.road_address_name as roadAddressName, p.place_lon as placeLon, p.place_lat as placeLat,
				6371*acos(cos(radians(#{lat}))*cos(radians(p.place_lat))*cos(radians(p.place_lon)-radians(#{lon})) +sin(radians(#{lat}))*sin(radians(p.place_lat))) as distance
		FROM place p
		LEFT JOIN category c on p.sub_category = c.sub_category 
		WHERE place_name LIKE CONCAT('%',#{keyword},'%') OR c.sub_category_name LIKE CONCAT('%',#{keyword},'%')
		HAVING distance &lt;= 0.5
		ORDER BY distance
		LIMIT 300
		
	</select>
	
	<select id="findByIdx" parameterType="map" resultType="com.cozydo.model.place.PlaceDto">
		SELECT place_idx as placeIdx, place_name as placeName, p.sub_category as subCategory, gu, p.dong, address_name as addressName,
				road_address_name as roadAddressName, place_lon as placeLon, place_lat as placeLat,
				IF(#{level} &lt;= g.not_food, 1, 0) as notFood, IF(#{level} &lt;= g.seat_one_apart, 1, 0) as seatOneApart,
				IF(#{level} &lt;= g.meet_prohibition, 1, 0) as meetProhibition, IF(#{level} &lt;= g.deadline_nine, 1, 0) as deadlineNine,
				IF(#{level} &lt;= g.qr_code, 1, 0) as qrCode, IF(#{level} &lt;= g.nomorepeople_nine, 1, 0) as nomorepeopleNine,
				IF(#{level} &lt;= g.twopeople_onehour, 1, 0) as twopeopleOnehour, IF(#{level} &lt;= g.shower_only, 1, 0) as showerOnly,
				IF(#{level} &lt;= g.lessthan_100, 1, 0) as lessthen100, IF(#{level} &lt;= g.lessthan_50, 1, 0) as lessthen50,
				IF(#{level} &lt;= g.family_only, 1, 0) as familyOnly, IF(#{level} &lt;= g.not_shower, 1, 0) as notShower
		FROM place p
		LEFT JOIN guide_line g on p.sub_category = g.sub_category
		WHERE place_idx = #{placeIdx}
		
	</select>
</mapper>